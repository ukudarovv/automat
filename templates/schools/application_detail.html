{% extends "base.html" %}

{% block title %}–ó–∞—è–≤–∫–∞ #{{ application.id }}{% endblock %}
{% block header %}–ó–∞—è–≤–∫–∞ #{{ application.id }}{% endblock %}

{% block dashboard_url %}{% url 'schools:dashboard' %}{% endblock %}
{% block applications_url %}{% url 'schools:applications' %}{% endblock %}

{% block content %}
<h2>–î–µ—Ç–∞–ª–∏ –∑–∞—è–≤–∫–∏</h2>

<div style="margin-top: 30px;">
    <div class="form-group">
        <label>–ò–º—è:</label>
        <p style="font-size: 18px;">{{ application.student_name }}</p>
    </div>
    <div class="form-group">
        <label>–¢–µ–ª–µ—Ñ–æ–Ω:</label>
        <p style="font-size: 18px;">
            <a href="tel:{{ application.student_phone }}">{{ application.student_phone }}</a>
            <button onclick="copyToClipboard('{{ application.student_phone }}')" class="btn" style="margin-left: 10px;">–ö–æ–ø–∏—Ä–æ–≤–∞—Ç—å</button>
        </p>
    </div>
    <div class="form-group">
        <label>–ì–æ—Ä–æ–¥:</label>
        <p>{{ application.city.name }}</p>
    </div>
    <div class="form-group">
        <label>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</label>
        <p>{{ application.category }}</p>
    </div>
    <div class="form-group">
        <label>–§–æ—Ä–º–∞—Ç:</label>
        <p>{{ application.get_format_display }}</p>
    </div>
    <div class="form-group">
        <label>–°—Ç–∞—Ç—É—Å:</label>
        <p>
            <span class="status status-{{ application.status }}">
                {{ application.get_status_display }}
            </span>
        </p>
    </div>
    <div class="form-group">
        <label>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</label>
        <p>{{ application.created_at|date:"d.m.Y H:i" }}</p>
    </div>
</div>

<div style="margin-top: 30px; padding-top: 20px; border-top: 2px solid #ddd;">
    <h3>–î–µ–π—Å—Ç–≤–∏—è</h3>
    
    <form method="post" action="{% url 'schools:update_status' application.pk %}" style="display: inline-block; margin-right: 10px;">
        {% csrf_token %}
        <select name="status" style="margin-right: 10px;">
            {% for value, label in status_choices %}
                <option value="{{ value }}" {% if application.status == value %}selected{% endif %}>
                    {{ label }}
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn">–ò–∑–º–µ–Ω–∏—Ç—å —Å—Ç–∞—Ç—É—Å</button>
    </form>
    
    <form method="post" action="{% url 'schools:send_response' application.pk %}" style="display: inline-block;">
        {% csrf_token %}
        <button type="submit" class="btn btn-success">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–≤—Ç–æ–æ—Ç–≤–µ—Ç</button>
    </form>
    
    {% if application.student.telegram_id %}
    <div style="margin-top: 20px;">
        <a href="https://wa.me/{{ application.student_phone|slice:'1:' }}?text=–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –≠—Ç–æ {{ school.name }}" 
           target="_blank" 
           class="btn" 
           style="background: #25D366;">
            üí¨ –ù–∞–ø–∏—Å–∞—Ç—å –≤ WhatsApp
        </a>
    </div>
    {% endif %}
</div>

<script>
function copyToClipboard(text) {
    navigator.clipboard.writeText(text).then(function() {
        alert('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ: ' + text);
    });
}
</script>
{% endblock %}

